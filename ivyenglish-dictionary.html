<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ivyDictionary - Tra cứu Song ngữ Thông minh</title>
    <meta name="description" content="Tra cứu từ điển Anh - Việt với phiên âm chuẩn, dịch nghĩa nhanh chóng và chính xác bằng công nghệ AI.">
    <link rel="canonical" href="https://ivyenglish.io.vn/ivyenglish-dictionary.html" />
    <link rel="icon" href="https://ivyenglish.io.vn/images/favicon.png" sizes="any">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; }
        .dictionary-wrapper { padding: 140px 0 100px; background: var(--bg-body); min-height: 100vh; position: relative; overflow: hidden; }
        .shape { position: absolute; filter: blur(60px); z-index: 0; opacity: 0.3; pointer-events: none; animation: floatShape 20s infinite alternate; }
        .shape-1 { width: 350px; height: 350px; background: #5b8cff; top: -100px; left: -100px; }
        .shape-2 { width: 300px; height: 300px; background: #ff7eb3; bottom: 10%; right: -50px; }
        
        .dict-container { position: relative; z-index: 5; max-width: 800px; margin: 0 auto; padding: 0 15px; }
        .search-container-premium { background: #fff; padding: 8px; border-radius: 50px; display: flex; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 2px solid #e2e8f0; transition: 0.3s; }
        .search-container-premium:focus-within { border-color: var(--primary-color); transform: translateY(-2px); }
        .search-container-premium input { flex: 1; border: none; padding: 12px 25px; font-size: 1.1rem; outline: none; background: transparent; color: #334155; font-weight: 500; }
        .btn-main-search { background: var(--primary-color); color: #fff; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* Style cho gợi ý sửa lỗi */
        #suggestionBox { display: none; text-align: center; margin-top: 15px; padding: 10px; background: #f0f7ff; border-radius: 12px; color: #64748b; border: 1px dashed #5b8cff; font-size: 0.9rem; }
        #suggestedWord { color: #5b8cff; font-weight: 700; cursor: pointer; text-decoration: underline; margin-left: 5px; }

        .topic-btn { background: #fff; border: 1px solid #e2e8f0; padding: 8px 18px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; color: #64748b; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .topic-btn:hover { background: var(--primary-color); color: #fff; border-color: var(--primary-color); transform: translateY(-2px); }

        .result-card { margin-top: 25px; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); padding: 30px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        .word-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .phonetic-text { color: #64748b; font-family: 'serif'; font-size: 1.2rem; margin-top: 5px; display: block; font-style: italic; }
        
        .speaker-group { display: flex; flex-direction: column; align-items: flex-end; gap: 10px; }
        .speaker-btn { width: 50px; height: 50px; border-radius: 50%; border: none; background: var(--primary-color); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.2s; }
        .voice-selector { padding: 5px 10px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 0.8rem; color: #64748b; background: white; max-width: 150px; }

        .meaning-box { background: #fff; padding: 20px; border-radius: 15px; border-left: 5px solid var(--primary-color); margin-bottom: 15px; }
        .example-box { background: #f8fafc; padding: 15px; border-radius: 12px; border-left: 5px solid #cbd5e1; margin-top: 10px; }
        .example-vi { color: #5b8cff; font-weight: 500; margin-top: 8px; display: block; font-size: 0.95rem; }
        .label-small { font-size: 0.7rem; text-transform: uppercase; font-weight: 900; color: #94a3b8; margin-bottom: 8px; display: block; }
        .history-tag { background: #e0e7ff; color: #5b8cff; padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; margin: 4px; display: inline-block; font-weight: 700; }
        @keyframes floatShape { 0% { transform: translate(0,0); } 100% { transform: translate(60px, 80px); } }
        .logo-text {
            font-weight: 900; 
            color: #5b8cff; 
            font-size: clamp(2.5rem, 8vw, 3.5rem); 
            margin: 0;
            display: inline-flex; /* Giúp căn chỉnh badge theo dòng chữ */
            align-items: flex-start;
            position: relative;
        }

        .beta-badge {
            background: #5b8cff; /* Màu hồng giống tone màu shape của bạn */
            color: white;
            font-size: 0.9rem; /* Chữ nhỏ lại */
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 6px;
            margin-left: 8px;
            text-transform: uppercase;
            vertical-align: top;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(255, 126, 179, 0.3);
            /* Tạo hiệu ứng hơi nghiêng cho cá tính (tùy chọn) */
            transform: translateY(-5px) rotate(5deg); 
        }

        /* Fix cho mobile nếu cần */
        @media (max-width: 768px) {
            .beta-badge {
                font-size: 0.7rem;
                padding: 1px 5px;
                transform: translateY(-2px) rotate(5deg);
            }
        }
    </style>
</head>
<body>

    <div id="header-placeholder"></div>

    <main class="dictionary-wrapper">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>

        <div class="dict-container">
            <div style="text-align: center; margin-bottom: 35px;" data-aos="fade-down">
                <h1 class="logo-text">
                    ivyDictionary<span class="beta-badge">Beta</span>
                </h1>
                <p style="color: #64748b;">Tra cứu Anh - Việt chuẩn từ Oxford</p>
            </div>

            <div class="search-container-premium" data-aos="zoom-in">
                <input type="text" id="dictInput" placeholder="Nhập từ cần tra..." autocomplete="off">
                <button class="btn-main-search" id="btnSearch"><i class="fas fa-search"></i></button>
            </div>

            <div id="suggestionBox" data-aos="fade-in">
                <i class="fas fa-lightbulb"></i> Có phải bạn muốn tìm: <span id="suggestedWord"></span>?
            </div>

            <div id="historySection" style="margin: 20px 0; display: none; text-align: center;">
                <div id="historyList"></div>
            </div>

            <div class="topic-suggestions" style="margin-top: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;" data-aos="fade-up">
                <button class="topic-btn" onclick="searchByTopic('travel')"><i class="fas fa-plane-departure"></i> Du lịch</button>
                <button class="topic-btn" onclick="searchByTopic('office')"><i class="fas fa-briefcase"></i> Công sở</button>
                <button class="topic-btn" onclick="searchByTopic('social')"><i class="fas fa-comments"></i> Giao tiếp</button>
                <button class="topic-btn" onclick="searchByTopic('academic')"><i class="fas fa-graduation-cap"></i> Học thuật</button>
            </div>

            <div id="dictResult" class="result-card" style="display: none;">
                <div class="word-header">
                    <div>
                        <h2 id="outWord" style="color: var(--primary-color); font-size: 2.2rem; margin: 0; font-weight: 900;"></h2>
                        <span id="outPhonetic" class="phonetic-text"></span>
                    </div>
                    <div class="speaker-group">
                        <select id="voiceSelect" class="voice-selector"></select>
                        <button class="speaker-btn" id="btnSpeak"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>
                <div class="meaning-box">
                    <span class="label-small">Dịch nghĩa</span>
                    <p id="outTranslate" style="font-size: 1.3rem; margin: 0; font-weight: 700; color: #1e293b;"></p>
                </div>
                <div id="exampleSection" class="example-box" style="display: none;">
                    <span class="label-small">Ví dụ (Example)</span>
                    <p id="outExample" style="color: #475569; font-style: italic; margin: 0;"></p>
                    <span id="outExampleVi" class="example-vi"></span>
                </div>
            </div>

            <div id="wordOfDaySection" class="result-card" style="border-left: 5px solid #ff7eb3;" data-aos="fade-up">
                <span class="label-small" style="color: #ff7eb3;"><i class="fas fa-star"></i> Từ vựng hôm nay</span>
                <div class="word-header">
                    <div>
                        <h2 style="color: #334155; font-size: 1.8rem; margin: 0; font-weight: 900;">Persistence</h2>
                        <span class="phonetic-text">/pəˈsɪstəns/</span>
                        <p style="color: #ff7eb3; font-weight: 700; margin: 5px 0 0 0; font-size: 1.1rem;">Sự kiên trì / Bền bỉ</p>
                    </div>
                    <button class="speaker-btn" style="background: #ff7eb3;" onclick="speak('Persistence')"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="example-box">
                    <span class="label-small">Ví dụ</span>
                    <p style="color: #475569; font-style: italic; margin:0;">"Her persistence finally paid off when she got the job."</p>
                    <span class="example-vi">Sự kiên trì của cô ấy cuối cùng đã được đền đáp khi cô ấy nhận được công việc.</span>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

        <div class="floating-contact">
        <a href="#" class="float-btn scroll-to-top" title="Lên đầu trang">
            <i class="fas fa-arrow-up"></i>
        </a>
        <a href="tel:0969730433" class="float-btn hotline" title="Hotline">
            <i class="fas fa-phone-alt"></i>
        </a>
        <a href="https://zalo.me/0969730433" target="_blank" class="float-btn zalo" title="Chat Zalo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Zalo">
        </a>
        <a href="https://www.facebook.com/profile.php?id=61576482823082" target="_blank" class="float-btn facebook-messenger" title="Nhắn tin Messenger">
            <i class="fab fa-facebook-messenger"></i>
        </a>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // --- 1. KHO TỪ VỰNG & THUẬT TOÁN SỬA LỖI ---
        const topicWords = {
            travel: ['Itinerary', 'Accommodation', 'Sightseeing', 'Destination', 'Baggage', 'Departure', 'Expedition', 'Souvenir', 'Reservation', 'Passport'],
            office: ['Collaborate', 'Deadline', 'Requirement', 'Procedure', 'Subordinate', 'Compensation', 'Strategy', 'Performance', 'Efficiency', 'Incentive'],
            social: ['Fluency', 'Interaction', 'Extrovert', 'Networking', 'Etiquette', 'Expression', 'Ambiguous', 'Sympathy', 'Charismatic', 'Small talk'],
            academic: ['Analysis', 'Hypothesis', 'Methodology', 'Definition', 'Theory', 'Evaluation', 'Significant', 'Literature', 'Objective', 'Empirical']
        };

        function getLevenshteinDistance(a, b) {
            const matrix = Array.from({ length: b.length + 1 }, (_, i) => [i]);
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    const cost = b[i - 1] === a[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + cost);
                }
            }
            return matrix[b.length][a.length];
        }

        function findSuggestion(wrongWord) {
            const allWords = Object.values(topicWords).flat();
            let bestMatch = null;
            let minDistance = 3; 
            allWords.forEach(word => {
                let dist = getLevenshteinDistance(wrongWord.toLowerCase(), word.toLowerCase());
                if (dist < minDistance && dist > 0) { minDistance = dist; bestMatch = word; }
            });
            return bestMatch;
        }

        // --- 2. GIỌNG NÓI ---
        let voices = [];
        function populateVoiceList() {
            voices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            if(!voiceSelect) return;
            const enVoices = voices.filter(v => v.lang.startsWith('en'));
            voiceSelect.innerHTML = enVoices.map(v => `<option value="${v.name}">${v.name}</option>`).join('');
        }
        window.speechSynthesis.onvoiceschanged = populateVoiceList;

        function speak(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            const voiceName = document.getElementById('voiceSelect').value;
            msg.voice = voices.find(v => v.name === voiceName) || voices[0];
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        }

        // --- 3. TRA CỨU VÀ DỊCH VÍ DỤ ---
        let history = JSON.parse(localStorage.getItem('ivy_history')) || [];

        async function translateText(text, pair) {
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${pair}`);
                const data = await res.json();
                return data.responseData.translatedText;
            } catch { return ""; }
        }

        async function handleSearch() {
            const query = document.getElementById('dictInput').value.trim();
            if (!query) return;

            document.getElementById('suggestionBox').style.display = 'none';
            document.getElementById('dictResult').style.display = 'none';
            document.getElementById('wordOfDaySection').style.display = 'none';

            try {
                const isViet = /[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(query);
                
                // 1. Dịch từ chính
                const translated = await translateText(query, isViet ? 'vi|en' : 'en|vi');
                if (!translated || translated.includes("MYMEMORY WARNING")) throw new Error();

                let phonetic = ""; let exampleEn = ""; let exampleVi = "";
                const englishWord = isViet ? translated : query;

                // 2. Lấy dữ liệu Oxford/Dictionary API
                const resDict = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(englishWord)}`);
                if (resDict.ok) {
                    const dataDict = await resDict.json();
                    phonetic = dataDict[0].phonetic || (dataDict[0].phonetics.find(p => p.text)?.text) || "";
                    for (let m of dataDict[0].meanings) {
                        for (let d of m.definitions) { 
                            if (d.example) { 
                                exampleEn = d.example; 
                                // 3. Dịch ví dụ sang tiếng Việt
                                exampleVi = await translateText(exampleEn, 'en|vi');
                                break; 
                            } 
                        }
                        if (exampleEn) break;
                    }
                }

                // Hiển thị kết quả
                document.getElementById('dictResult').style.display = 'block';
                document.getElementById('outWord').innerText = query;
                document.getElementById('outPhonetic').innerText = phonetic ? `[ ${phonetic} ]` : "";
                document.getElementById('outTranslate').innerText = translated;
                document.getElementById('btnSpeak').onclick = () => speak(englishWord);
                
                if (exampleEn) {
                    document.getElementById('exampleSection').style.display = 'block';
                    document.getElementById('outExample').innerText = `"${exampleEn}"`;
                    document.getElementById('outExampleVi').innerText = exampleVi;
                }

                // Lưu lịch sử
                if (!history.includes(query)) {
                    history = [query, ...history].slice(0, 5);
                    localStorage.setItem('ivy_history', JSON.stringify(history));
                    renderHistory();
                }

            } catch (e) {
                // Xử lý khi sai từ
                const suggestion = findSuggestion(query);
                if (suggestion) {
                    document.getElementById('suggestionBox').style.display = 'block';
                    document.getElementById('suggestedWord').innerText = suggestion;
                    document.getElementById('suggestedWord').onclick = () => {
                        document.getElementById('dictInput').value = suggestion;
                        handleSearch();
                    };
                } else {
                    alert("Không tìm thấy từ này, hãy thử lại nhé!");
                    document.getElementById('wordOfDaySection').style.display = 'block';
                }
            }
        }

        // Các hàm phụ trợ
        function searchByTopic(cat) {
            const words = topicWords[cat];
            document.getElementById('dictInput').value = words[Math.floor(Math.random() * words.length)];
            handleSearch();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length > 0) {
                document.getElementById('historySection').style.display = 'block';
                list.innerHTML = history.map(w => `<span class="history-tag" onclick="quickSearch('${w}')">${w}</span>`).join('');
            }
        }

        function quickSearch(word) {
            document.getElementById('dictInput').value = word;
            handleSearch();
        }

        // Khởi tạo AOS
        document.addEventListener('DOMContentLoaded', () => {
            renderHistory();
            populateVoiceList();
            AOS.init();
            document.getElementById('btnSearch').onclick = handleSearch;
            document.getElementById('dictInput').onkeypress = (e) => { if(e.key === 'Enter') handleSearch(); };
        });

        async function includeHTML() {
        const components = [
            { id: 'header-placeholder', file: 'header.html' },
            { id: 'footer-placeholder', file: 'footer.html' }
        ];

        for (const comp of components) {
            const element = document.getElementById(comp.id);
            if (element) {
                try {
                    const response = await fetch(comp.file);
                    if (response.ok) {
                        element.innerHTML = await response.text();
                    }
                } catch (err) {
                    console.error("Lỗi khi tải file: " + comp.file, err);
                }
            }
        }

        // Sau khi nội dung đã được chèn vào HTML, mới khởi tạo Logic Menu
        initMenuLogic();

        // Ẩn preloader
        setTimeout(() => {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.opacity = '0';
                preloader.style.visibility = 'hidden';
                setTimeout(() => preloader.style.display = 'none', 500);
            }
        }, 600);
    }

    function initMenuLogic() {
        const menuToggle = document.querySelector('.menu-toggle');
        const nav = document.getElementById('main-nav');
        const dropdowns = document.querySelectorAll('.dropdown');

        if (!menuToggle || !nav) return;

        // --- LOGIC ĐÓNG MỞ THANH MENU 3 SỌC ---
        menuToggle.addEventListener('click', function() {
            nav.classList.toggle('nav-open'); 
            menuToggle.classList.toggle('menu-active'); 
            
            if (menuToggle.classList.contains('menu-active')) {
                menuToggle.classList.replace('fa-bars', 'fa-times');
            } else {
                menuToggle.classList.replace('fa-times', 'fa-bars');
            }
            document.body.classList.toggle('no-scroll');
        });
        
        // --- LOGIC CHẶN CHUYỂN TRANG CHO DROPDOWN TRÊN MOBILE ---
        dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        
        toggle.addEventListener('click', function(e) {
            // Chỉ can thiệp khi màn hình nhỏ (Mobile/Tablet)
            if (window.innerWidth <= 768) {
                
                // Nếu dropdown này chưa được mở (chưa có class 'active')
                if (!dropdown.classList.contains('active')) {
                    e.preventDefault(); // Chặn ngay hành động chuyển trang của thẻ <a>
                    
                    // Đóng tất cả các dropdown khác đang mở để tránh bị đè nhau
                    dropdowns.forEach(d => d.classList.remove('active'));
                    
                    // Mở dropdown hiện tại
                    dropdown.classList.add('active');
                } 
                // Nếu đã có class 'active' (đã mở rồi), bấm lần nữa sẽ chuyển trang bình thường
            }
        });
    });

        // Đóng dropdown khi bấm ra ngoài
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                dropdowns.forEach(d => d.classList.remove('active'));
            }
        });

        // Tự động đóng menu khi bấm vào một link (dành cho anchor link #)
        nav.querySelectorAll('a:not(.dropdown-toggle)').forEach(link => {
            link.addEventListener('click', () => {
                nav.classList.remove('nav-open');
                menuToggle.classList.remove('menu-active');
                menuToggle.classList.replace('fa-times', 'fa-bars');
                document.body.classList.remove('no-scroll');
            });
        });
        
        // Reset khi xoay ngang màn hình hoặc đổi kích thước
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                nav.classList.remove('nav-open');
                menuToggle.classList.remove('menu-active');
                menuToggle.classList.replace('fa-times', 'fa-bars');
                document.body.classList.remove('no-scroll');
                dropdowns.forEach(d => d.classList.remove('active'));
            }
        });
    }

    // Chạy duy nhất một sự kiện khởi tạo
    document.addEventListener("DOMContentLoaded", includeHTML);

    const scrollToTopButton = document.querySelector('.scroll-to-top');

        window.onscroll = function() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                scrollToTopButton.style.display = "flex";
            } else {
                scrollToTopButton.style.display = "none";
            }
        };

        scrollToTopButton.addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>