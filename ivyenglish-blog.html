<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="SIO0aKLY9cZk8-k09UBuQ6r3zaNIMu_pswgELE3FVWw" />
    <title>ivyEnglish - Blog & Chia S·∫ª Ki·∫øn Th·ª©c</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="canonical" href="https://ivyenglish.io.vn/ivyenglish-blog.html" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" href="https://ivyenglish.io.vn/images/favicon.png" sizes="any">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        :root { --p-blue: #1a237e; --s-gold: #c5a059; --accent: #5b8cff; }
        
        /* SEARCH BAR */
        .search-container { max-width: 600px; margin: -30px auto 40px; position: relative; z-index: 10; padding: 0 20px; }
        .search-wrapper { display: flex; background: white; border-radius: 50px; padding: 8px 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .search-wrapper input { border: none; outline: none; flex: 1; padding: 10px; font-size: 1rem; color: #334155; }
        .search-wrapper i { display: flex; align-items: center; color: var(--accent); font-size: 1.2rem; }

        /* SKELETON */
        .skeleton { background: #eee; background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); border-radius: 12px; background-size: 200% 100%; animation: 1.5s shine linear infinite; }
        .skeleton-img { height: 220px; width: 100%; }
        .skeleton-text { height: 20px; margin-bottom: 10px; width: 80%; }
        @keyframes shine { to { background-position-x: -200%; } }

        /* GRID 3 COLUMNS - ƒê√£ s·ª≠a l·ªói t√†ng h√¨nh */
        .blog-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 30px; min-height: 100px; }
        @media (max-width: 992px) { .blog-group { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .blog-group { grid-template-columns: 1fr; } }

        .blog-hero { background: linear-gradient(135deg, var(--p-blue) 0%, #2a3eb1 100%); padding: 120px 20px 80px; text-align: center; color: white; clip-path: ellipse(150% 100% at 50% 0%); }
        .blog-card { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.3s; display: flex; flex-direction: column; border: 1px solid rgba(0,0,0,0.03); opacity: 1 !important; } /* √âp hi·ªÉn th·ªã */
        .blog-card:hover { transform: translateY(-10px); }
        .blog-card img { width: 100%; height: 220px; object-fit: cover; }
        .blog-card-body { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .blog-category { background: rgba(91, 140, 255, 0.1); color: var(--accent); padding: 4px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; width: fit-content; margin-bottom: 12px; text-transform: uppercase; }
        .blog-title { font-size: 1.15rem; font-weight: 700; color: var(--p-blue); line-height: 1.4; margin-bottom: 10px; }
        .btn-readmore { margin-top: auto; color: var(--accent); font-weight: 700; text-decoration: none; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        /* MODAL */
        #postModal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); }
        .modal-container { background: #fff; margin: 2% auto; padding: 40px; border-radius: 20px; max-width: 900px; max-height: 90vh; overflow-y: auto; position: relative; }
        .close-btn {
            position: fixed; /* Gi·ªØ c·ªë ƒë·ªãnh so v·ªõi khung nh√¨n */
            top: 20px;
            right: calc(50% - 430px); /* CƒÉn theo container 900px */
            z-index: 10001; /* Lu√¥n n·∫±m tr√™n c√πng */
            width: 45px;
            height: 45px;
            background: #fff;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 1px solid #eee;
        }

        .close-btn:hover {
            background: #f8f9fa;
            transform: rotate(90deg);
            color: var(--accent);
        }
        .cta-box { background: #f0f7ff; padding: 25px; border-radius: 15px; border-left: 5px solid var(--accent); margin-top: 40px; text-align: center; }
        
        .category-divider { margin: 40px 0 20px; display: flex; align-items: center; gap: 15px; }
        .category-divider h2 { color: var(--p-blue); font-size: 1.5rem; white-space: nowrap; }
        .category-divider .line { height: 2px; background: #eee; flex: 1; }

        @media (max-width: 768px) { .modal-container { margin: 0; width: 100%; height: 100%; border-radius: 0; padding: 20px; } .close-btn {
            right: 20px; /* Tr√™n mobile th√¨ c√°ch l·ªÅ ph·∫£i 20px */
            top: 15px;
            width: 40px;
            height: 40px;
            font-size: 24px;
        }}
    </style>
</head>
<body>
        <div id="preloader">
            <div class="loader-content">
                <div class="logo-wrapper">
                    <img src="images/logo.png" alt="Logo" class="loader-logo">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    <div id="header-placeholder"></div>

    <section class="blog-hero">
        <div class="container" data-aos="zoom-in">
            <h1>Blog ivyEnglish</h1>
            <p>Ki·∫øn th·ª©c h·ªØu √≠ch, t√†i li·ªáu ƒë·ªôc quy·ªÅn v√† tin t·ª©c gi√°o d·ª•c m·ªõi nh·∫•t.</p>
        </div>
    </section>

    <div class="search-container" data-aos="fade-up">
        <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" id="blogSearch" placeholder="T√¨m b√†i vi·∫øt (IELTS, t·ª´ v·ª±ng, m·∫πo h·ªçc...)" onkeyup="handleSearch()">
        </div>
    </div>

    <section class="blog-section" style="padding: 0 20px 80px; max-width: 1200px; margin: auto;">
        <div id="blog-container">
            <div class="blog-group">
                <div class="blog-card"><div class="skeleton skeleton-img"></div><div class="blog-card-body"><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width:50%"></div></div></div>
                <div class="blog-card"><div class="skeleton skeleton-img"></div><div class="blog-card-body"><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width:50%"></div></div></div>
                <div class="blog-card"><div class="skeleton skeleton-img"></div><div class="blog-card-body"><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width:50%"></div></div></div>
            </div>
        </div>
    </section>

    <div id="footer-placeholder"></div>

    <div id="postModal">
        <div class="modal-container">
            <span class="close-btn" onclick="closePost()">&times;</span>
            <div id="modal-content"></div>
            <div class="cta-box">
                <h4>B·∫°n th·∫•y ki·∫øn th·ª©c n√†y h·ªØu √≠ch?</h4>
                <p>Nh·∫≠n ngay l·ªô tr√¨nh h·ªçc ti·∫øng Anh c√° nh√¢n h√≥a mi·ªÖn ph√≠ t·∫°i ivyEnglish.</p>
                <a href="ivyenglish-level-test.html" style="display:inline-block; margin-top:10px; background:var(--accent); color:white; padding:12px 25px; border-radius:50px; text-decoration:none; font-weight:bold;">ƒêƒÉng k√Ω Test tr√¨nh ƒë·ªô ngay</a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        let allPosts = [];
        const API_URL = "https://script.google.com/macros/s/AKfycby4hbtnsT1hpHRDaQ2QEaydOSmVHy7Jle8gGZySh6tOs4R3zHo9uGitcCk4jpfhZuLD/exec?sheet=Posts";
        const ORIGIN_TITLE = document.title;

        async function initBlog() {
            const cached = localStorage.getItem("ivy_blog_cache");
            if (cached) {
                allPosts = JSON.parse(cached);
                renderUI(allPosts);
            }

            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                if (data && data.length > 0) {
                    allPosts = data.reverse();
                    localStorage.setItem("ivy_blog_cache", JSON.stringify(allPosts));
                    renderUI(allPosts);
                    checkUrlForPost();
                }
            } catch (e) { console.error(e); }
        }

        function renderUI(data) {
            const container = document.getElementById('blog-container');
            const groups = data.reduce((acc, post) => {
                (acc[post.category] = acc[post.category] || []).push(post);
                return acc;
            }, {});

            let html = "";
            for (let cat in groups) {
                html += `
                    <div class="category-divider" data-aos="fade-right"><h2>${cat}</h2><div class="line"></div></div>
                    <div class="blog-group">${renderCards(groups[cat].slice(0, 3))}</div>
                `;
            }
            container.innerHTML = html || "<p style='text-align:center;'>Kh√¥ng c√≥ b√†i vi·∫øt.</p>";
            
            // QUAN TR·ªåNG: L√†m m·ªõi AOS ƒë·ªÉ hi·ªán b√†i vi·∫øt t√†ng h√¨nh
            setTimeout(() => { AOS.refresh(); }, 100);
        }

        function renderCards(posts) {
            return posts.map(post => {
                const idx = allPosts.findIndex(p => p.title === post.title);
                return `
                    <div class="blog-card" data-aos="zoom-in">
                        <img src="${post.image}" alt="${post.title}" loading="lazy">
                        <div class="blog-card-body">
                            <span class="blog-category">${post.category}</span>
                            <h3 class="blog-title">${post.title}</h3>
                            <div class="blog-time">üìÖ ${post.time}</div>
                            <a onclick="viewPost(${idx})" class="btn-readmore">ƒê·ªçc th√™m <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function handleSearch() {
            const query = document.getElementById('blogSearch').value.toLowerCase();
            const container = document.getElementById('blog-container');
            if (!query) return renderUI(allPosts);
            
            const filtered = allPosts.filter(p => p.title.toLowerCase().includes(query) || p.category.toLowerCase().includes(query));
            container.innerHTML = `<div class="blog-group">${renderCards(filtered)}</div>`;
            AOS.refresh();
        }

        window.viewPost = function(index) {
            const post = allPosts[index];
            if (!post) return;
            document.title = post.title + " | ivyEnglish Blog";
            document.getElementById('modal-content').innerHTML = `
                <span class="blog-category">${post.category}</span>
                <h1 style="color:var(--p-blue); margin:15px 0; line-height:1.3;">${post.title}</h1>
                <p style="color:#888; margin-bottom:20px;">üìÖ ${post.time}</p>
                <div class="post-full-content" style="line-height:1.8;">${post.content}</div>
            `;
            document.getElementById('postModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            window.history.pushState({}, '', `?id=${encodeURIComponent(post.title)}`);
        };

        function closePost() {
            document.getElementById('postModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.title = ORIGIN_TITLE;
            window.history.pushState({}, '', window.location.pathname);
        }

        function checkUrlForPost() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (id) {
                const idx = allPosts.findIndex(p => p.title === decodeURIComponent(id));
                if (idx !== -1) viewPost(idx);
            }
        }

        async function includeHTML() {
            const comps = [{ id: 'header-placeholder', file: 'header.html' }, { id: 'footer-placeholder', file: 'footer.html' }];
            for (const c of comps) {
                const el = document.getElementById(c.id);
                if (el) {
                    const res = await fetch(c.file);
                    if (res.ok) el.innerHTML = await res.text();
                }
            }
            initBlog();
            AOS.init({ duration: 800, once: true });
            setTimeout(() => { document.getElementById('preloader').style.display = 'none'; }, 500);
        }

        document.addEventListener("DOMContentLoaded", includeHTML);
        window.onclick = function(e) { if(e.target.id === 'postModal') closePost(); }
    </script>
</body>
</html>