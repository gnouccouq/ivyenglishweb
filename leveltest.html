<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra trình độ - ivyEnglish</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { 
            --primary-color: #5b8cff; 
            --secondary-color: #2ECC71;
            --text-color: #1e293b; 
            --bg-body: #f4f7fa; 
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.4);
            --shadow-soft: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        body { 
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-body) !important;
            color: var(--text-color);
            min-height: 100vh;
        }

        /* --- HEADER --- */
        header { 
            position: fixed; top: 0; width: 100%; z-index: 1000; 
            background: rgba(51, 65, 85, 0.9); backdrop-filter: blur(10px); 
            height: 70px; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-container { 
            max-width: 1100px; margin: 0 auto; display: flex; 
            justify-content: space-between; align-items: center; 
            height: 100%; padding: 0 20px; 
        }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary-color); text-decoration: none; }
        .logo span { color: var(--secondary-color); }

        /* --- LAYOUT CHÍNH --- */
        .main-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 100px 20px 40px; /* Cách header 100px */
            min-height: calc(100vh - 140px);
        }

        .test-container {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(15px) saturate(180%);
            -webkit-backdrop-filter: blur(15px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 850px;
            box-shadow: var(--shadow-soft);
        }

        #exam-screen, #result-screen { display: none; }

        .level-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
        }
        .level-table th, .level-table td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.3); }
        .level-table th { background: var(--primary-color); color: white; }

        .btn-action {
            background: var(--secondary-color);
            color: white;
            padding: 15px 45px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2);
            transition: 0.3s;
        }
        .btn-action:hover { transform: translateY(-3px); box-shadow: 0 15px 25px rgba(46, 204, 113, 0.3); }

        .reading-box {
            background: rgba(255, 255, 255, 0.4);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary-color);
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid var(--glass-border);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        .option:hover { background: white; transform: translateX(5px); }
        .option.selected { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        .progress-bar { height: 8px; background: rgba(0,0,0,0.05); border-radius: 10px; margin: 20px 0; }
        .progress { height: 100%; background: var(--primary-color); width: 0%; border-radius: 10px; transition: 0.3s; }
        .timer { font-weight: 900; color: #ef4444; font-size: 1.2rem; }

        
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="index.html"><img src="images/logo.png" alt="Logo" style="height: 40px;"></a>
            <div style="display: flex; gap: 20px;">
                <a href="index.html" style="color: white; text-decoration: none; font-weight: 500; font-size: 0.9rem;">Home</a>
                <a href="index.html#courses" style="color: white; text-decoration: none; font-weight: 500; font-size: 0.9rem;">Courses</a>
            </div>
        </div>
    </header>

    <div class="main-wrapper">
        <div id="intro-screen" class="test-container">
            <h2 style="text-align: center; color: var(--primary-color);">HƯỚNG DẪN KIỂM TRA</h2>
            <p style="text-align: center;">Vui lòng xem bảng quy đổi trình độ dự kiến:</p>

            <table class="level-table">
                <thead>
                    <tr>
                        <th>Số câu đúng</th>
                        <th>Trình độ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>0 - 3 câu</td><td><strong>A1 (Beginner)</strong></td></tr>
                    <tr><td>4 - 6 câu</td><td><strong>A2 (Elementary)</strong></td></tr>
                    <tr><td>7 - 8 câu</td><td><strong>B1 (Intermediate)</strong></td></tr>
                    <tr><td>9 - 10 câu</td><td><strong>B2 (Upper-Intermediate)</strong></td></tr>
                </tbody>
            </table>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn-action" onclick="startExam()">BẮT ĐẦU LÀM BÀI</button>
            </div>
        </div>

        <div id="exam-screen" class="test-container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div class="timer" id="timer">10:00</div>
                <div id="question-counter">Câu hỏi 1/10</div>
            </div>
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
            
            <div id="quiz-content">
                <div id="reading-passage" class="reading-box" style="display: none;">
                    <strong>Reading Passage:</strong><br>
                    "My name is Sarah and I live in a small town. I have been learning English for two years because I want to travel around the world. At first, speaking was very difficult for me, but I practiced every day. Now, I can communicate with foreigners confidently. I believe that learning a new language opens many doors to different cultures. Next year, I am planning to visit London to improve my accent and experience the local lifestyle."
                </div>
                
                <h3 id="question-text" style="margin-bottom: 20px;"></h3>
                <div id="options-container"></div>
            </div>

            <div style="margin-top: 30px; text-align: right;">
                <button id="next-btn" class="btn-action" style="padding: 10px 30px; font-size: 1rem;" onclick="nextQuestion()">Tiếp theo</button>
            </div>
        </div>

        <div id="result-screen" class="test-container" style="text-align: center;">
            <h2 style="color: var(--secondary-color);">Hoàn thành!</h2>
            <div style="font-size: 4rem; font-weight: 900; margin: 10px 0;"><span id="score-number">0</span>/10</div>
            <h3 id="suggested-course" style="color: var(--primary-color);">--</h3>
            <p id="course-desc" style="margin-bottom: 30px; padding: 0 20px;">--</p>
            <button class="btn-action" onclick="location.href='index.html'">VỀ TRANG CHỦ</button>
        </div>
    </div>

    <script>
        // GIỮ NGUYÊN 10 CÂU HỎI CỦA BẠN
        const questions = [
            { q: "Person A: 'How's it going?' - Person B: '________'", a: ["A. I'm 20 years old.", "B. Not bad, thanks.", "C. I go by bus.", "D. Yes, I like it."], c: 1 },
            { q: "What should you say when you accidentally bump into someone?", a: ["A. Excuse me.", "B. I'm sorry.", "C. Never mind.", "D. You're welcome."], c: 1 },
            { q: "At a restaurant, you want to pay. You ask:", a: ["A. How much money?", "B. Can I have the bill, please?", "C. Where is the food?", "D. Give me the price."], c: 1 },
            { q: "A friend says 'Good luck with your exam!'. You reply:", a: ["A. Same to you.", "B. Thank you, I'll need it!", "C. No problem.", "D. I don't know."], c: 1 },
            { q: "If you don't hear what someone said, you say:", a: ["A. What?", "B. Can you say that again, please?", "C. Speak louder.", "D. I am deaf."], c: 1 },
            { q: "Why is Sarah learning English?", a: ["A. To get a job.", "B. To travel the world.", "C. To watch movies.", "D. To live in a small town."], c: 1 },
            { q: "How long has she been learning English?", a: ["A. One year.", "B. Two years.", "C. Five years.", "D. Next year."], c: 1 },
            { q: "What was Sarah's main problem at the beginning?", a: ["A. Reading.", "B. Writing.", "C. Speaking.", "D. Listening."], c: 2 },
            { q: "What does Sarah plan to do next year?", a: ["A. Move to a new town.", "B. Visit London.", "C. Stay at home.", "D. Buy a new car."], c: 1 },
            { q: "What does Sarah think about learning a new language?", a: ["A. It is a waste of time.", "B. It is only for travelers.", "C. It opens many doors to cultures.", "D. It is very boring."], c: 2 }
        ];

        let currentIdx = 0;
        let score = 0;
        let timeLeft = 600; 
        let timerInterval;
        let selectedIdx = null;

        function startExam() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('exam-screen').style.display = 'block';
            startTimer();
            renderQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                let m = Math.floor(timeLeft / 60);
                let s = timeLeft % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                if (timeLeft <= 0) showResults();
            }, 1000);
        }

        function renderQuestion() {
            const q = questions[currentIdx];
            document.getElementById('question-counter').innerText = `Câu hỏi ${currentIdx + 1}/${questions.length}`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('progress').style.width = ((currentIdx + 1) / questions.length) * 100 + '%';
            
            // Chỉ hiện bài đọc từ câu 6 đến 10
            document.getElementById('reading-passage').style.display = (currentIdx >= 5) ? 'block' : 'none';

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.a.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.innerText = opt;
                div.onclick = () => {
                    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedIdx = idx;
                };
                container.appendChild(div);
            });
        }

        function nextQuestion() {
            if (selectedIdx === null) { alert("Vui lòng chọn đáp án!"); return; }
            if (selectedIdx === questions[currentIdx].c) score++;
            selectedIdx = null;
            currentIdx++;
            if (currentIdx < questions.length) renderQuestion(); else showResults();
        }

        function showResults() {
            clearInterval(timerInterval);
            document.getElementById('exam-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('score-number').innerText = score;

            let level = "", desc = "";
            if (score <= 3) { 
                level = "A1 - BEGINNER"; 
                desc = "Bạn đang ở trình độ bắt đầu. Khóa học A1 sẽ giúp bạn xây dựng nền tảng vững chắc."; 
            } else if (score <= 6) { 
                level = "A2 - ELEMENTARY"; 
                desc = "Khá tốt! Khóa A2 sẽ giúp bạn giao tiếp tự tin hơn trong đời sống."; 
            } else if (score <= 8) { 
                level = "B1 - INTERMEDIATE"; 
                desc = "Rất tốt! Bạn có thể sử dụng tiếng Anh linh hoạt trong nhiều tình huống."; 
            } else { 
                level = "B2 - UPPER INTERMEDIATE"; 
                desc = "Xuất sắc! Bạn có khả năng sử dụng tiếng Anh chuyên sâu và tự nhiên."; 
            }

            document.getElementById('suggested-course').innerText = level;
            document.getElementById('course-desc').innerText = desc;
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
    </script>
</body>
</html>